<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="root-home">
  <template>
    <firebase-query
      id="query"
      path="/articles/published"
      data="{{article}}"
    >  
    </firebase-query>
    
    <firebase-document
      id="removal"
      path="/articles/published/{{removeId}}"
      data="{{trash}}"
    >
    </firebase-document>
    
    <firebase-document
      id="swap"
      path="/articles/temp"
      data="{{new}}"
    >
    </firebase-document>
    
    
    
    <style>
      .inputSize{
        height: 60px;
      }
      .flex-center-align {
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        @apply(--layout-wrap);
        
      }
      .flex-center-justified {
        @apply(--layout-vertical);
        @apply(--layout-center-center);
      }
      .flex-wrap {
        
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
      }
      
      .tile {
        display: inline-block;
        float: left;
        vertical-align: top;
        
        @apply(--paper-font-title);
        @apply(--layout-vertical);
        @apply(--layout-center-center);
      }
      
      .container {
        width: 100%;
      }
      .unifiedWidth{
        min-width: 250px;
        max-width: 250px;
        margin: 10px;
      }
      .ninja{
        display: none;
      }
      .shogun{
        display: block;
      }
      
    </style>
    
    
    
    <div
      class="container flex-center-align"
    >
      <paper-dialog
        id="articleModal"
        with-backdrop
      >
        <div>
          {{trash}}
        </div>
      </paper-dialog>
      
      <template 
        is="dom-repeat" 
        items="{{article}}"
      >
        <paper-card 
          image="https://s-media-cache-ak0.pinimg.com/564x/8f/0d/14/8f0d14d355d2c957d43247407fed6cb9.jpg" c
          class="unifiedWidth "
        >
          <paper-material 
            id="{{headId(index)}}" 
            elevation="0"
            class="inputSize shogun"
          > 
            <div 
              class="flex-center-align"
            >
              <div>
                [[item.title]]
              </div>
            </div>
          </paper-material>
          
          <template 
            is="dom-if" 
            if="{{mine(item.uid)}}"
          >
            <template 
              is="dom-if" 
              if="{{mine(item.uid)}}"
            >
              <paper-input 
                id="{{titleId(index)}}" 
                label="title" 
                name="title" 
                class="ninja" 
                value="{{item.title}}"
              ></paper-input>
            </template>
          </template>
          
          <paper-material 
            id="{{contextId(index)}}" 
            elevation="0" 
            class="inputSize shogun"
          > 
            <div>
              [[readMore(item.context)]]
              
              <paper-button 
                on-tap="moreOpen" 
              >
                More
              </paper-button>
            </div>
          </paper-material>
          
          <template 
            is="dom-if" 
            if="{{mine(item.uid)}}"
          >
            <paper-input 
              id="{{textId(index)}}" 
              label="context" 
              name="context" 
              class="ninja" 
              value="{{item.context}}"
            ></paper-input>
          </template>
          
          <div 
            class="card-actions flex-center-align"
          >
            <template 
              is="dom-if" 
              if="{{mine(item.uid)}}"
            >
              <paper-button 
                value="{{index}}" 
                on-click="showMe"
              >
                <iron-icon 
                  id="{{iconId(index)}}" 
                  value="{{index}}" 
                  icon="create"
                ></iron-icon>
              </paper-button>
              
              <paper-button 
                id="{{clearId(index)}}"
                value="{{item.$key}}" 
                on-click="deleteMe"
                class="shogun"
              >
                <iron-icon 
                  value="{{item.$key}}" 
                  icon="clear"
                ></iron-icon>
              </paper-button>
              
              <paper-button 
                id="{{draftId(index)}}"
                value="{{item}}" 
                on-click="draftMe"
                class="ninja"
              >
                <iron-icon 
                  value="{{item}}" 
                  icon="drafts"
                ></iron-icon>
              </paper-button>
            </template>
            
            <template 
              is="dom-if" 
              if="{{!mine(item.uid)}}"
            >
              <paper-button>
                <iron-icon 
                  icon="face"
                ></iron-icon>
              </paper-button>
            </template>
          </div>
        </paper-card>
      </template>
    </div>
  </template>
  
  
  
  <script>
    
    Polymer({

      is: 'root-home',
      properties: {
        uid: String,
        removeId: String,
        user: {
          type: Object,
          notify: true,
          reflectToAttribute: true,
          observer: 'updateUser'
        },
        data: {
          type: Object,
          observer: 'dataChanged'
        },
       
      },
    
      ready: function() {
        console.log("Harder Better Faster Stronger");   
      },
    
      dataChanged: function (newData, oldData) {
        // do something when the query returns values
      },
      
      updateUser: function(user) {
        if (user) {
          this.uid = user.uid;
        }
      },
      
      mine: function(myId) {
        return myId === this.uid;
      },
      
      showMe: function(e) {
        
        console.log( this.$$(`#iconic${e.target.value}`) );
        
        if(this.$$(`#context${e.target.value}`).style.display === "none"){
          this.$$(`#title${e.target.value}`).style.display = "none";
          this.$$(`#text${e.target.value}`).style.display = "none";
          this.$$(`#draft${e.target.value}`).style.display = "none";
          this.$$(`#icon${e.target.value}`).icon = "create";
          this.$$(`#clear${e.target.value}`).style.display = "block";
          this.$$(`#context${e.target.value}`).style.display = "block";
          this.$$(`#head${e.target.value}`).style.display = "block";
        }else{
          this.$$(`#title${e.target.value}`).style.display = "block";
          this.$$(`#text${e.target.value}`).style.display = "block";
          this.$$(`#draft${e.target.value}`).style.display = "block";
          this.$$(`#icon${e.target.value}`).icon = "check";
          this.$$(`#clear${e.target.value}`).style.display = "none";
          this.$$(`#context${e.target.value}`).style.display = "none";
          this.$$(`#head${e.target.value}`).style.display = "none";
        }
        
      },
      
      titleId: function(idTitle) {
        return `title${idTitle}`;
      },
      
      textId: function(idText) {
        return `text${idText}`;
      },
      
      iconId: function(idIcon) {
        return `icon${idIcon}`;
      },
      
      clearId: function(idIcon) {
        return `clear${idIcon}`;
      },
      
      draftId: function(idIcon) {
        return `draft${idIcon}`;
      },
      
      contextId: function(contextIcon) {
        return `context${contextIcon}`;
      },
      
      headId: function(contextIcon) {
        return `head${contextIcon}`;
      },
      
      checkUser: function(userId) {
        return !!userId;
      },
      
      readMore: function(content) {
        if(content.length <= 45){
          return content;
        }else{
          return `${content.substring(0,45)} ...`;
        }
      },
      
      deleteMe: function(e) {
        this.removeId = e.target.value;
        this.$.removal.destroy().then(function(){
          console.log("Success");
        });
      },
      
      moreOpen: function(e) {
        this.$.articleModal.open();
      },
      
      draftMe: function(e) {
        console.log(e.target.value);
       
        this.$.swap.data = {
          title: e.target.value.title,
          context: e.target.value.context,
          uid: e.target.value.uid
        };
        
        this.$.swap.save("/articles/drafted");
  
        this.$.swap.reset();

        this.removeId = e.target.value.$key;
        this.$.removal.destroy().then(function(){
          console.log("Success");
        });
      }
      
    });

  </script>

</dom-module>
